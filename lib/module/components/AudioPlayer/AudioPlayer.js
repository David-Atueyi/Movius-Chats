import e,{useState as t,useRef as o,useEffect as r}from"react";import{PanResponder as n,View as s,Pressable as a,Text as l}from"react-native";import i,{useSharedValue as u,withSpring as c,useAnimatedStyle as d}from"react-native-reanimated";import A from"react-native-sound";import m from"twrnc";import{PauseIcon as p}from"../../assets/Icons/PauseIcon.js";import{PlayIcon as y}from"../../assets/Icons/PlayIcon.js";import{useAudio as C}from"../../context/AudioContext.js";import{useChatContext as h}from"../../context/ChatContext.js";import{formatDuration as v}from"../../utils/datefunc.js";import{jsxs as f,jsx as g}from"react/jsx-runtime";const P={code:"function AudioPlayerTsx1(){const{knobPosition}=this.__closure;return{transform:[{translateX:knobPosition.value}]};}",location:"/home/eadav/Documents/packages/Movius-Chats/src/components/AudioPlayer/AudioPlayer.tsx",sourceMap:'{"version":3,"names":["AudioPlayerTsx1","knobPosition","__closure","transform","translateX","value"],"sources":["/home/eadav/Documents/packages/Movius-Chats/src/components/AudioPlayer/AudioPlayer.tsx"],"mappings":"AAoIyC,SAAAA,eAAMA,CAAA,QAAAC,YAAA,OAAAC,SAAA,CAC3C,MAAO,CACLC,SAAS,CAAE,CAAC,CAAEC,UAAU,CAAEH,YAAY,CAACI,KAAM,CAAC,CAChD,CAAC,CACH","ignoreList":[]}',version:"3.16.7"},w=({audioUrl:e,audioId:w,isVideoPlaying:S})=>{const{theme:x,CustomPlayIcon:b,CustomPauseIcon:I}=h(),{currentlyPlayingId:_,setCurrentlyPlayingId:k}=C(),[M,N]=t(null),[R,D]=t(!1),[E,j]=t(0),[T,X]=t(0),[H,O]=t(!1),B=o(null),L=o(0),U=o(0),Y=o(0),K=u(0);r((()=>{let t=!0;const o=new A(e,"",(e=>{!e&&t&&X(o.getDuration())}));return N(o),()=>{t=!1,o&&(o.pause(),o.release())}}),[e]),r((()=>{_&&_!==w&&R&&M&&(M.pause(),D(!1),j(0),K.value=0)}),[_,w,R,M]),r((()=>{let e;return R&&M&&!H&&(e=setInterval((()=>{M.getCurrentTime((e=>{if("number"==typeof e&&!isNaN(e)&&(j(e),L.current>0&&T>0)){const t=e/T*L.current;isNaN(t)||(K.value=c(t,{damping:15,stiffness:100}))}}))}),100)),()=>{e&&clearInterval(e)}}),[R,M,H,T]);const V=n.create({onStartShouldSetPanResponder:()=>!0,onMoveShouldSetPanResponder:()=>!0,onPanResponderGrant:e=>{O(!0),Y.current=e.nativeEvent.pageX-K.value},onPanResponderMove:e=>{if(L.current>0){const t=e.nativeEvent.pageX-Y.current,o=Math.max(0,Math.min(t,L.current));K.value=o;const r=o/L.current*T;isNaN(r)||j(r)}},onPanResponderRelease:()=>{if(O(!1),M&&L.current>0){const e=K.value/L.current*T;isNaN(e)||M.setCurrentTime(e)}},onPanResponderTerminate:()=>{O(!1)}}),z=d(function(){const e=[new global.Error,-2,-27],t=function(){return{transform:[{translateX:K.value}]}};return t.__closure={knobPosition:K},t.__workletHash=1935336866997,t.__initData=P,t.__stackDetails=e,t}());return r((()=>{S&&R&&M&&M.pause((()=>{D(!1),k(null)}))}),[S]),f(s,{style:m`rounded-lg w-56`,children:[f(s,{style:m`flex-row items-center gap-2 px-2 pt-2`,children:[g(a,{onPress:()=>{M&&(R?M.pause((()=>{D(!1),k(null)})):(k(w),M.play((e=>{e&&(D(!1),j(0),K.value=c(0),k(null))})),D(!0)))},style:[m`bg-black/40 rounded-full p-2`,x?.messageStyle?.audioPlayButtonStyle],children:R?I?g(I,{}):g(p,{style:m.style("h-6 w-6"),color:x?.colors?.audioPauseIconColor||"white"}):b?g(b,{}):g(y,{style:m.style("h-6 w-6"),color:x?.colors?.audioPlayIconColor||"white"})}),f(s,{ref:B,onLayout:e=>{const{width:t}=e.nativeEvent.layout;L.current=t,B.current?.measure(((e,t,o,r,n)=>{U.current=n}))},style:[m`relative h-1 bg-zinc-400 rounded overflow-visible w-[75%]`,x?.messageStyle?.progressBarStyle],children:[g(s,{style:[m`absolute h-full bg-slate-200`,{width:(T>0?E/T*100:0)+"%"},x?.messageStyle?.activeProgressBarStyle]}),g(i.View,{...V.panHandlers,style:[z,{position:"absolute",top:-6,width:16,height:16,borderRadius:8,backgroundColor:"white",shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.25,shadowRadius:3.84,elevation:5},{...x?.messageStyle?.audioKnobStyle}]})]})]}),g(s,{style:m`px-4 py-1`,children:g(l,{style:[m`text-xs text-gray-500`,x?.messageStyle?.audioDurationStyle],children:isNaN(E)?"0:00":v(E)})})]})};var S=e.memo(w);export{S as default};
//# sourceMappingURL=AudioPlayer.js.map
